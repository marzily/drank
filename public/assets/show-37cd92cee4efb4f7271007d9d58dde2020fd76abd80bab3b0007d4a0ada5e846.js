function initMap(){coordinates=coords(),map=new google.maps.Map(document.getElementById("map"),{center:coordinates,zoom:13,scrollwheel:!1}),userMarker(),geocoder();var e={drink:$("#recommended").text()};loadRestaurants(e)}function coords(){return{lat:$("#coordinates").data("lat"),lng:$("#coordinates").data("lng")}}function userMarker(){new google.maps.Marker({position:coordinates,map:map,icon:"https://maps.google.com/mapfiles/ms/icons/yellow-dot.png"})}function geocoder(){var e=new google.maps.Geocoder;e.geocode({location:coordinates},setLocation)}function setLocation(e,n){if("OK"===n)var o=e[1].address_components;var a={};o.forEach(function(e){for(var n in e)"types"===n&&(-1!==e[n].indexOf("locality")?a.city=e.long_name:-1!==e[n].indexOf("administrative_area_level_1")&&(a.state=e.short_name))}),loadDash(a)}function loadDash(e){$("#weather").prepend("<h2>"+e.city+", "+e.state+"</h2>"),currentConditions(e)}function currentConditions(e){var n=formatCity(e.city);$.ajax({url:"https://api.wunderground.com/api/20e32ff3e81ba1e5/geolookup/conditions/q/"+e.state+"/"+n+".json",dataType:"jsonp",success:renderTemp})}function formatCity(e){return-1!==e.indexOf(" ")?e.replace(" ","_"):e}function renderTemp(e){var n=e.current_observation.temp_f;$("#weather").append("<h1>"+n+" &#8457;</h1>"),temp(n)}function temp(e){$.ajax({url:"/users",type:"GET",data:{temp_f:e},error:function(e){console.error(e)}})}function loadRestaurants(e){$.ajax({url:"/drink",type:"GET",data:e,dataType:"json",success:restaurantMarkers,error:function(e){console.error(e)}})}function restaurantMarkers(e){var n=[];e.forEach(function(e){var o=e.hash,a=createInfoWindow(o);n.push(a);var r=createMarker(o);markers.push(r)}),attachInfoWindow(markers,n)}function createInfoWindow(e){var n='<div class="restaurant"><h5><a href='+e.url+">"+e.name+"</a></h5><p>"+e.location.display_address[0]+"</p><p>"+e.location.display_address[1]+"</p><ul><li><img src="+e.rating_img_url+"></li><li> "+e.review_count+" reviews</li></ul></div>";return new google.maps.InfoWindow({content:n})}function createMarker(e){var n={lat:e.location.coordinate.latitude,lng:e.location.coordinate.longitude};return new google.maps.Marker({position:n,map:map,title:e.name})}function attachInfoWindow(e,n){e.forEach(function(e,o){e.addListener("click",function(){n[o].open(map,e)})})}function dropdownItemSelect(){$(".dropdown-menu").children().children().on("click",function(){var e={drink:$(this).text()};resetMarkers(e),$("#recommended").text(e.drink)})}function resetMarkers(e){markers.forEach(function(e){e.setMap(null)}),loadRestaurants(e)}var map,coordinates,markers=[];$(document).ready(function(){dropdownItemSelect()});