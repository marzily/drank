function initMap(){var coordinates=coords(),map=new google.maps.Map(document.getElementById("map"),{center:coordinates,zoom:13}),marker=new google.maps.Marker({position:coordinates,map:map,icon:"https://maps.google.com/mapfiles/ms/icons/yellow-dot.png"}),geocoder=new google.maps.Geocoder;geocoder.geocode({location:coordinates},loadDash);for(var restaurants=$("#restaurants").data("restaurants"),i=0;i<restaurants.length;i++){var restaurantHash=restaurants[i].hash,contentString='<div class="restaurant"><h5><a href='+restaurantHash.url+">"+restaurantHash.name+"</a></h5><p>"+restaurantHash.location.display_address[0]+"</p><p>"+restaurantHash.location.display_address[1]+"</p><ul><li><img src="+restaurantHash.rating_img_url+"></li><li> "+restaurantHash.review_count+" reviews</li></ul></div>";eval("infowindow"+i+" = new google.maps.InfoWindow({ content: contentString })");var rest_coord={lat:restaurantHash.location.coordinate.latitude,lng:restaurantHash.location.coordinate.longitude};eval("marker"+i+"=new google.maps.Marker({position: rest_coord,map: map,title: restaurantHash['name']})"),eval("marker"+i+".addListener('click', function() {infowindow"+i+".open(map, marker"+i+");});")}}function coords(){return{lat:$("#coordinates").data("lat"),lng:$("#coordinates").data("lng")}}function loadDash(e,a){if("OK"===a)var t=e[1].address_components;var n,o;t.forEach(function(e){for(var a in e)"types"===a&&(-1!==e[a].indexOf("locality")?n=e.long_name:-1!==e[a].indexOf("administrative_area_level_1")&&(o=e.short_name))}),postCityState(n,o),currentConditions(n,o)}function postCityState(e,a){$.ajax({url:"/city_state",type:"POST",data:{city:e,state:a},error:function(e){console.error(e)}})}function currentConditions(e,a){var t=-1!==e.indexOf(" ")?e.replace(" ","_"):e;$.ajax({url:"https://api.wunderground.com/api/20e32ff3e81ba1e5/geolookup/conditions/q/"+a+"/"+t+".json",dataType:"jsonp",success:temp})}function temp(e){var a=e.current_observation.temp_f;$.ajax({url:"/current_conditions",type:"POST",data:{temp_f:a},error:function(e){console.error(e)}})}function drinkRestaurants(){$.ajax({url:"/drink",type:"POST",data:{drink:$("#recommended").text()},success:dropdownItemSelect,error:function(e){console.error(e)}})}function dropdownItemSelect(){$(".dropdown-menu").children().children().on("click",updateRecommended)}function updateRecommended(){var e={drink_type:$(this).text()};$.ajax({url:"/drink",type:"POST",data:e,error:function(e){console.error(e)}}),$("#recommended").text(e.drink_type)}$(document).ready(function(){drinkRestaurants()});